function ApplyCouponCode(a){var b=jQuery("#gf_coupon_code_"+a).val();"undefined"!==b&&""!=b&&(jQuery("#gf_coupons_container_"+a+" #gf_coupon_spinner").show(),jQuery("#gf_coupons_container_"+a+" #gf_coupon_button").prop("disabled",!0),jQuery.post(gform_coupon_script_strings.ajaxurl,{action:"gf_apply_coupon_code",couponCode:b,existing_coupons:jQuery("#gf_coupon_codes_"+a).val(),formId:a,total:jQuery("#gf_total_no_discount_"+a).val()},function(b){var c=jQuery.parseJSON(b);if(jQuery("#gf_coupons_container_"+a+" .gf_coupon_invalid").remove(),jQuery("#gf_coupon_code_"+a).val(""),c.is_valid){window["gf_coupons"+a]=c.coupons;var d,e="",f=0;for(d in window["gf_coupons"+a])f>0&&(e+=","),e+=window["gf_coupons"+a][d].code,f++;jQuery("#gf_coupon_codes_"+a).val(e).change(),jQuery("#gf_coupons_"+a).val(jQuery.toJSON(window["gf_coupons"+a])),gformCalculateTotalPrice(a)}else jQuery("#gf_coupons_container_"+a+" #gf_coupon_info").prepend("<div class='gf_coupon_invalid'><span>"+c.invalid_reason+"</span></div>");jQuery("#gf_coupons_container_"+a+" #gf_coupon_spinner").hide()}))}function GetDiscount(a,b,c,d){var e;return c-=d,e="flat"==a?Number(b):c*Number(b/100),gform.applyFilters("gform_coupons_discount_amount",e,a,b,c,d)}function PopulateDiscountInfo(a,b){var c,d,e,f,g="",h=0,i=new Currency(gf_global.gf_currency_config);void 0===window["gf_coupons"+b]&&(window["gf_coupons"+b]=jQuery.evalJSON(jQuery("#gf_coupons_"+b).val()));for(c in window["gf_coupons"+b])d=window["gf_coupons"+b][c],e=GetDiscount(d.type,d.amount,a,h),h+=e,f=d.code.replace(/[^A-Za-z0-9]/g,""),g+='<tr class="gf_coupon_item" id="gf_coupon_'+f+'"><td class="gf_coupon_name_container">   <a href="javascript:void(0);" onclick="DeleteCoupon(\''+d.code+"' , '"+b+'\');">(x)</a>   <span class="gf_coupon_name">'+d.name+'</span></td><td class="gf_coupon_discount_container">   <span class="gf_coupon_discount">-'+i.toMoney(e,!0)+"</span></td></tr>";return jQuery("#gf_coupons_container_"+b+" #gf_coupon_info").html("<table>"+g+"</table>"),h}function DisableApplyButton(a){0==window["new_total_"+a]||""==jQuery("#gf_coupon_code_"+a).val()?jQuery("#gf_coupons_container_"+a+" #gf_coupon_button").prop("disabled",!0):jQuery("#gf_coupons_container_"+a+" #gf_coupon_button").prop("disabled",!1)}function DeleteCoupon(a,b){if(!jQuery("#gf_coupons_container_"+b+" #gf_coupon_spinner").is(":visible")){var c=a.replace(/[^A-Za-z0-9]/g,"");jQuery("#gf_coupons_container_"+b+" #gf_coupon_"+c).remove(),jQuery("#gf_coupons_container_"+b+" #gf_coupon_spinner").show(),jQuery("#gf_coupons_container_"+b+" #gf_coupon_button").prop("disabled",!0);var d=jQuery("#gf_coupon_codes_"+b),e=d.val().split(","),f=jQuery.inArray(a,e);-1!=f&&(e.splice(f,1),d.val(e.join(",")).change(),a in window["gf_coupons"+b]&&(delete window["gf_coupons"+b][a],jQuery("#gf_coupons_"+b).val(jQuery.toJSON(window["gf_coupons"+b]))),gformCalculateTotalPrice(b))}}gform.addFilter("gform_product_total",function(a,b){if(0==jQuery("#gf_coupon_code_"+b).length)return a;jQuery("#gf_total_no_discount_"+b).val(a);var c=gformIsHidden(jQuery("#gf_coupon_code_"+b))?"":jQuery("#gf_coupon_codes_"+b).val(),d=""!=c||""!=jQuery("#gf_coupons_"+b).val(),e=a;if(d){e=a-PopulateDiscountInfo(a,b)}return jQuery("#gf_coupons_container_"+b+" #gf_coupon_spinner").hide(),window["new_total_"+b]=e,DisableApplyButton(b),e},50),gform.addFilter("gform_is_value_match",function(a,b,c){var d=jQuery("#field_"+b+"_"+c.fieldId).find("#gf_coupon_codes_"+b);return d.length?gf_matches_operation(d.val(),c.value,c.operator):a}),gform.addAction("gform_post_conditional_logic_field_action",function(a,b,c,d,e){if(!e&&"hide"==b){var f=jQuery(c),g=f.find("tr.gf_coupon_item");g.length&&(g.remove(),f.find("input[type=hidden]").val("").change())}});